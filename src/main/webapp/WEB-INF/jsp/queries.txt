SELECT
C.NAME,
T2.AMOUNT
FROM
CATEGORIES C LEFT JOIN
(SELECT
T1.CATEGORY_ID,
SUM(T1.AMOUNT) AMOUNT
FROM
(SELECT
T.CATEGORY_ID,
-SUM(T.AMOUNT) AMOUNT
FROM TRANSACTIONS T
GROUP BY T.CATEGORY_ID, T.TYPE
HAVING T.TYPE = 0
UNION
SELECT
T.CATEGORY_ID,
SUM(T.AMOUNT)
FROM TRANSACTIONS T
GROUP BY T.CATEGORY_ID, T.TYPE
HAVING T.TYPE = 1) T1
GROUP BY T1.CATEGORY_ID) T2 ON T2.CATEGORY_ID=C.ID


SELECT
t.category.name,
-SUM(t.amount)
FROM Transaction t
GROUP BY t.category.name
HAVING t.type = :typeWithdraw